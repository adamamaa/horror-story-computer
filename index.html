<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µí¬ ì´ì•¼ê¸°</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    
    <style>
        /* ì „ì²´ í˜ì´ì§€ ë° ì…ë ¥/ë²„íŠ¼ ìš”ì†Œì— VT323 í°íŠ¸ ì ìš© */
        body, input, button {
            font-family: 'VT323', monospace;
        }
        /* í™”ë©´ ê¹œë¹¡ì„(flicker) íš¨ê³¼ë¥¼ ìœ„í•œ ê°€ìƒ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        body::after {
            content: " ";
            display: block;
            position: fixed; /* Use fixed to cover the whole viewport */
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.04), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.04));
            z-index: 2; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œë˜ë„ë¡ z-index ì„¤ì • */
            background-size: 100% 4px, 3px 100%; /* ìŠ¤ìº”ë¼ì¸ íš¨ê³¼ í¬ê¸° */
            pointer-events: none; /* ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ í†µê³¼ */
            animation: flicker 0.15s infinite; /* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ ì ìš© */
        }
        /* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
        @keyframes flicker {
          0% { opacity: 0.219; }
          5% { opacity: 0.946; }
          10% { opacity: 0.515; }
          15% { opacity: 0.958; }
          20% { opacity: 0.364; }
          25% { opacity: 0.794; }
          30% { opacity: 0.117; }
          35% { opacity: 0.534; }
          40% { opacity: 0.196; }
          45% { opacity: 0.18; }
          50% { opacity: 0.471; }
          55% { opacity: 0.419; }
          60% { opacity: 0.719; }
          65% { opacity: 0.103; }
          70% { opacity: 0.817; }
          75% { opacity: 0.152; }
          80% { opacity: 0.21; }
          85% { opacity: 0.86; }
          90% { opacity: 0.34; }
          95% { opacity: 0.67; }
          100% { opacity: 0.33; }
        }

        /* ì±„íŒ…ì°½ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        #chatbox::-webkit-scrollbar {
            width: 8px;
        }
        #chatbox::-webkit-scrollbar-track {
            background: #1a1a1a; /* ìŠ¤í¬ë¡¤ë°” íŠ¸ë™ ë°°ê²½ìƒ‰ */
            border-radius: 0; /* ê°ì§„ ëª¨ì„œë¦¬ */
        }
        #chatbox::-webkit-scrollbar-thumb {
            background: #00ff00; /* ìŠ¤í¬ë¡¤ë°” ìƒ‰ìƒ (ë…¹ìƒ‰) */
            border-radius: 0; /* ê°ì§„ ëª¨ì„œë¦¬ */
        }
        #chatbox::-webkit-scrollbar-thumb:hover {
            background: #00cc00; /* ìŠ¤í¬ë¡¤ë°” í˜¸ë²„ ì‹œ ìƒ‰ìƒ */
        }
        /* í…ìŠ¤íŠ¸ ê¸€ë¡œìš° íš¨ê³¼ */
        .text-glow {
             text-shadow: 0 0 5px #00ff00, 0 0 10px #00ff00;
        }
        /* ìŒì•… ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #musicControl {
            position: fixed; /* í™”ë©´ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ê³ ì • */
            top: 20px;
            right: 20px;
            background-color: #00ff00;
            color: black;
            border: 1px solid #00cc00;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 1rem;
            z-index: 10; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œë˜ë„ë¡ z-index ì„¤ì • */
        }
         #musicControl:hover {
             background-color: #00cc00;
         }
         /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
         .chat-image {
             max-width: 80%; /* ì´ë¯¸ì§€ ìµœëŒ€ ë„ˆë¹„ */
             max-height: 300px; /* ì´ë¯¸ì§€ ìµœëŒ€ ë†’ì´ */
             border: 1px solid #00ff00; /* ë…¹ìƒ‰ í…Œë‘ë¦¬ */
             margin-top: 8px; /* ìœ„ìª½ ì—¬ë°± */
             display: block; /* ë¸”ë¡ ìš”ì†Œë¡œ ë§Œë“¤ì–´ ê°€ìš´ë° ì •ë ¬ ìš©ì´ */
             margin-left: auto;
             margin-right: auto;
         }
    </style>
</head>
<body class="bg-black flex flex-col items-center min-h-screen p-4 pt-8">

    <button id="musicControl">ìŒì•… ì¼œê¸°</button>

    <div class="w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2 bg-black border-4 border-gray-700 rounded-lg shadow-xl overflow-hidden flex flex-col mx-auto" style="min-height: 60vh; max-height: 85vh; box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);">
        
        <div class="bg-black p-3 border-b-2 border-gray-700 text-center">
            <h1 class="text-2xl font-bold text-green-500 text-glow">[ ê²½ê³ : ê³µí¬ ì´ì•¼ê¸° ë´‡ ]</h1>
        </div>

        <div id="chatbox" class="flex-1 p-6 overflow-y-auto space-y-4 bg-black text-green-400 text-lg">
            <div class="flex justify-start">
                <div class="bg-transparent p-2 rounded-none max-w-xs text-glow">
                    ...ë¬´ìŠ¨ ì´ì•¼ê¸°ë¥¼ ë“£ê³  ì‹¶ìœ¼ì‹ ê°€ìš”...? 'ì´ì•¼ê¸° í•´ì¤˜' ë¼ê³  ë§í•´ë³´ì„¸ìš”... ğŸ’€
                </div>
            </div>
        </div>

        <div class="p-4 bg-black border-t-2 border-gray-700 flex items-center space-x-2">
            <span class="text-green-500 text-glow text-xl">></span>
            <input type="text" id="userInput" class="flex-1 bg-transparent border border-green-700 rounded-none px-3 py-1 text-green-400 focus:outline-none focus:ring-1 focus:ring-green-500 placeholder-gray-600 text-lg" placeholder="ë¬´ì–¸ê°€ ì†ì‚­ì—¬ ë³´ì„¸ìš”..." autocomplete="off">
            <button type="button" id="sendButton" class="bg-green-700 hover:bg-green-600 text-black font-bold py-1 px-3 rounded-none border border-green-900 transition duration-200 ease-in-out text-lg">
                ì „ì†¡
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM is fully loaded");
            
            const chatbox = document.getElementById('chatbox');
            const userInput = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');
            const musicControlButton = document.getElementById('musicControl');

            if (!chatbox || !userInput || !sendButton || !musicControlButton) {
                console.error("í•„ìˆ˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return; 
            } else {
                console.log("All required elements loaded successfully");
            }

            // --- ì˜¤ë””ì˜¤ ì„¤ì • ---
            let synth = null; 
            let loop = null;  
            let musicPlaying = false;

            function setupMusic() {
                // ìŒì•… ì„¤ì •ì€ ì‚¬ìš©ìì˜ ì²« ìƒí˜¸ì‘ìš©(í´ë¦­ ë“±) í›„ì— Tone.start()ê°€ ì„±ê³µì ìœ¼ë¡œ í˜¸ì¶œëœ ë‹¤ìŒì— ì§„í–‰í•©ë‹ˆë‹¤.
                if (!Tone.context || Tone.context.state !== 'running') {
                    console.warn("AudioContext not ready for setupMusic.");
                    return; // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì„¤ì •í•˜ì§€ ì•ŠìŒ
                }
                if (synth) return; // ì´ë¯¸ ìƒì„±ëœ ê²½ìš° ì¤‘ë³µ ë°©ì§€

                try {
                    synth = new Tone.FMSynth({
                        harmonicity: 3, modulationIndex: 10, detune: 0,
                        oscillator: { type: "sine" },
                        envelope: { attack: 0.01, decay: 0.1, sustain: 0.5, release: 1 },
                        modulation: { type: "square" },
                        modulationEnvelope: { attack: 0.5, decay: 0, sustain: 1, release: 0.5 }
                    }).toDestination();

                    const reverb = new Tone.Reverb(4).toDestination();
                    synth.connect(reverb);

                    const pattern = new Tone.Pattern((time, note) => {
                        if (Math.random() < 0.8) {
                            synth.triggerAttackRelease(note, "8n", time);
                        } else if (Math.random() < 0.9) {
                             synth.triggerAttackRelease("C2", "4n", time); 
                        }
                         synth.volume.rampTo(Math.random() * -20 - 10, 0.5);
                    }, ["C3", "D#3", null, "C3", null, "F#2", null, "G#2"], "randomWalk"); 
                    pattern.interval = "2n"; 
                    Tone.Transport.bpm.value = 40; 
                    loop = pattern; 
                    console.log("Music setup complete.");
                } catch (error) {
                    console.error("Error setting up music:", error);
                    // í•„ìš”í•œ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì˜¤ë””ì˜¤ ì„¤ì • ì‹¤íŒ¨ë¥¼ ì•Œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                }
            }

            async function toggleMusic() {
                try {
                    // ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì‹œì‘ ì‹œë„
                    if (Tone.context.state !== 'running') {
                        await Tone.start();
                        console.log("AudioContext started by user interaction.");
                        // ì»¨í…ìŠ¤íŠ¸ ì‹œì‘ í›„ ì¦‰ì‹œ ìŒì•… ì„¤ì • ì‹œë„
                        setupMusic();
                    }
                } catch (error) {
                    console.error("Failed to start AudioContext:", error);
                    alert("ì˜¤ë””ì˜¤ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    return; // ì˜¤ë””ì˜¤ ì‹œì‘ ì‹¤íŒ¨ ì‹œ ë” ì´ìƒ ì§„í–‰í•˜ì§€ ì•ŠìŒ
                }

                 // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ê°€ ì‹œì‘ëœ í›„ì—ë§Œ ìŒì•… ì„¤ì • ë° ì¬ìƒ
                if (Tone.context.state === 'running') {
                    if (!synth) { // synthê°€ ì•„ì§ ì„¤ì •ë˜ì§€ ì•Šì•˜ë‹¤ë©´ (ì²« í´ë¦­ ì‹œ)
                        setupMusic(); 
                    }
                    
                    // synthì™€ loopê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸ í›„ ì¬ìƒ/ì •ì§€ ë¡œì§ ì‹¤í–‰
                    if (synth && loop) {
                        if (musicPlaying) {
                            Tone.Transport.stop();
                            loop.stop(); 
                            musicControlButton.textContent = "ìŒì•… ì¼œê¸°";
                            musicPlaying = false;
                            console.log("Music stopped");
                        } else {
                            if (Tone.Transport.state !== "started") {
                                Tone.Transport.start();
                            }
                            loop.start(0); 
                            musicControlButton.textContent = "ìŒì•… ë„ê¸°";
                            musicPlaying = true;
                            console.log("Music started");
                        }
                    } else {
                        console.error("Synth or Loop not initialized properly.");
                        // setupMusic ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                        alert("ìŒì•… ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    }
                } else {
                    console.warn("AudioContext not running. Music cannot be played yet.");
                }
            }


            musicControlButton.addEventListener('click', toggleMusic);

            // --- ì±—ë´‡ ë¡œì§ ---
            const defaultBotResponses = [ 
                "...",
                "ê³„ì† ë§í•´ë³´ì„¸ìš”...",
                "ë“£ê³  ìˆì–´ìš”...",
                "ê·¸ë˜ì„œ...",
                "í¥ë¯¸ë¡­êµ°ìš”...",
                "ì •ë§ì¸ê°€ìš”?",
                "ì–´ë‘  ì†ì—ì„œ ë¬´ì–¸ê°€ ëŠê»´ì§€ì§€ ì•Šë‚˜ìš”?",
                "ì‰¿...",
            ];

            const horrorStories = [
                "1. ë§ˆì§€ë§‰ ë©”ì‹œì§€\nìƒˆë²½ 3ì‹œ, ìŠ¤ë§ˆíŠ¸í° í™”ë©´ì´ ê°‘ìê¸° ë°ì•„ì§€ë©´ì„œ ì•Œë¦¼ìŒì´ ìš¸ë ¸ë‹¤.\nì¡¸ë¦° ëˆˆìœ¼ë¡œ í™”ë©´ì„ í™•ì¸í•œ ìˆœê°„, ë‚˜ëŠ” ìˆ¨ì´ ë©ëŠ” ê²ƒ ê°™ì•˜ë‹¤.\n3ê°œì›” ì „ ëŒì•„ê°€ì‹  í• ë¨¸ë‹ˆì˜ ë²ˆí˜¸ì—ì„œ ë©”ì‹œì§€ê°€ ì˜¨ ê²ƒì´ë‹¤.\n\"ì†ë…€ì•¼, ì´ì œ ê³§ ë§Œë‚˜ì. ë‚´ê°€ ë„ˆë¥¼ ë°ë¦¬ëŸ¬ ê°ˆê²Œ.\"\nì†ì´ ë–¨ë¦¬ë©° íœ´ëŒ€í°ì„ ë–¨ì–´ëœ¨ë ¸ë‹¤.\nê·¸ ìˆœê°„ ì°½ë¬¸ì— ëˆ„êµ°ê°€ ì†í†±ìœ¼ë¡œ ê¸ëŠ” ì†Œë¦¬ê°€ ë“¤ë¦¬ê¸° ì‹œì‘í–ˆê³ ,\në°© ì•ˆì— í• ë¨¸ë‹ˆ íŠ¹ìœ ì˜ ë¼ë²¤ë” í–¥ê¸°ê°€ í¼ì ¸ë‚˜ê°”ë‹¤.\nì¹¨ëŒ€ ë°‘ì—ì„œëŠ” ë­”ê°€ ëŒë¦¬ëŠ” ì†Œë¦¬ê°€ ë“¤ë ¤ì™”ë‹¤.\nìš©ê¸°ë¥¼ ë‚´ì–´ ì•„ë˜ë¥¼ ë³´ë‹ˆ, í• ë¨¸ë‹ˆê°€ í‰ì†Œ ì¦ê²¨ ì‹ ë˜ ë‚¡ì€ ìŠ¬ë¦¬í¼ê°€ ì¹¨ëŒ€ ë°‘ì—ì„œ ì²œì²œíˆ ê¸°ì–´ ë‚˜ì˜¤ê³  ìˆì—ˆë‹¤.",
                "2. ê±°ìš¸ ì† ë‚¯ì„  ì´\në§¤ì¼ ì•„ì¹¨ í™”ì¥ì‹¤ ê±°ìš¸ì„ ë³¼ ë•Œë§ˆë‹¤, ë‚´ ë’¤ì— í¬ë¯¸í•˜ê²Œ ë³´ì´ëŠ” ê·¸ë¦¼ìê°€ ìˆì—ˆë‹¤.\nì²˜ìŒì—ëŠ” ë‹¨ìˆœí•œ ì°©ì‹œë¼ê³  ìƒê°í–ˆì§€ë§Œ, ë‚ ì´ ê°ˆìˆ˜ë¡ ê·¸ í˜•ì²´ê°€ ì ì  ë˜ë ·í•´ì§€ê³  ê°€ê¹Œì›Œì¡Œë‹¤.\nì¼ì£¼ì¼ì§¸ ë˜ëŠ” ë‚ , ê·¸ ê·¸ë¦¼ìëŠ” ì´ì œ ì™„ì „í•œ ì‚¬ëŒì˜ í˜•ìƒì„ ê°–ì¶”ì—ˆê³ , ë‚´ê°€ ì›€ì§ì¼ ë•Œë§ˆë‹¤ ë¯¸ì„¸í•œ ì‹œê°„ì°¨ë¡œ ë”°ë¼ ì›€ì§ì˜€ë‹¤.\nì—´í˜ì§¸ ë˜ëŠ” ë‚ , ê·¸ê²ƒì€ ë‚´ ë’¤ì—ì„œ ë¶ˆê³¼ 30ì„¼í‹°ë¯¸í„° ê±°ë¦¬ê¹Œì§€ ë‹¤ê°€ì™”ê³ , ì´ì œëŠ” ê±°ìš¸ ì†ì—ì„œ ê·¸ê²ƒì˜ ìˆ¨ì†Œë¦¬ê°€ ë“¤ë¦¬ê¸° ì‹œì‘í–ˆë‹¤.\nì˜¤ëŠ˜ ì•„ì¹¨, ê·¸ê²ƒì´ ë‚´ ì–´ê¹¨ì— ì°¨ê°€ìš´ ì†ì„ ì–¹ì—ˆë‹¤.\nê±°ìš¸ ì†ì—ì„œ ëˆˆì´ ë§ˆì£¼ì³¤ì„ ë•Œ, ë‚˜ëŠ” ê·¸ê²ƒì˜ ì–¼êµ´ì´ ì ì  ë‚´ ì–¼êµ´ì„ ë‹®ì•„ê°€ê³  ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ê¹¨ë‹¬ì•˜ë‹¤.\nê·¸ë¦¬ê³  ì €ë…, ê±°ìš¸ ì•ì— ì„  ë‚´ ëª¨ìŠµì€ ë” ì´ìƒ ë‚´ê°€ ì•„ë‹ˆì—ˆë‹¤.\në‚´ ëª¸ ì•ˆì— ê°‡íŒ ì˜í˜¼ì€ ê±°ìš¸ ì†ì—ì„œ ì ˆë§ì ìœ¼ë¡œ ë‚˜ë¥¼ ë°”ë¼ë³´ê³  ìˆì—ˆë‹¤.",
                "3. ì§€í•˜ì‹¤ì˜ ì†Œë¦¬\nì„¸ ë°¤ ì—°ì†ìœ¼ë¡œ ì§€í•˜ì‹¤ì—ì„œ í¬ë¯¸í•œ ë‘ë“œë¦¬ëŠ” ì†Œë¦¬ê°€ ë“¤ë ¤ì™”ë‹¤.\nì²˜ìŒì—ëŠ” íŒŒì´í”„ ì†Œë¦¬ë¼ê³  ìƒê°í–ˆì§€ë§Œ, ì ì  ê·œì¹™ì ì¸ íŒ¨í„´ìœ¼ë¡œ ë°”ë€Œì—ˆê³ , ë§ˆì¹˜ ëˆ„êµ°ê°€ê°€ ëª¨ìŠ¤ ë¶€í˜¸ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ê²ƒ ê°™ì•˜ë‹¤.\nìš©ê¸°ë¥¼ ë‚´ì–´ ì§€í•˜ì‹¤ë¡œ ë‚´ë ¤ê°”ì§€ë§Œ, ë¶ˆì„ ì¼œì ê·¸ê³³ì—ëŠ” ì•„ë¬´ë„ ì—†ì—ˆê³  ì†Œë¦¬ë„ ë©ˆì·„ë‹¤.\nêµ¬ì„êµ¬ì„ ì‚´í´ë´ë„ ì´ìƒí•œ ì ì„ ë°œê²¬í•  ìˆ˜ ì—†ì—ˆë‹¤.\nì•ˆë„ê°ì„ ëŠë¼ë©° ë‹¤ì‹œ ì˜¬ë¼ì™€ ì§€í•˜ì‹¤ ë¬¸ì„ ë‹«ê³  ì—´ì‡ ë¡œ ë‹¨ë‹¨íˆ ì ê°”ë‹¤.\nê³„ë‹¨ì„ ì˜¬ë¼ê°€ë ¤ëŠ” ìˆœê°„, ë“± ë’¤ì—ì„œ ì°¨ê°€ìš´ ìˆ¨ê²°ì´ ëŠê»´ì¡Œë‹¤.\n\"ê³ ë§ˆì›Œ, ì´ì œ ìš°ë¦¬ ë‘˜ ë¿ì´ì•¼.\" ëˆ„êµ°ê°€ê°€ ë‚´ ê·€ì— ì†ì‚­ì˜€ë‹¤.\nì²œì²œíˆ ë’¤ë¥¼ ëŒì•„ë³´ë‹ˆ, ì§€í•˜ì‹¤ ë²½ì— ìˆë˜ ì˜¤ë˜ëœ ê±°ìš¸ ì†ì—ì„œ ë‚´ ëª¨ìŠµì´ ì›ƒê³  ìˆì—ˆë‹¤.\nê·¸ë¦¬ê³  ê·¸ ì›ƒëŠ” ë‚´ ëª¨ìŠµì€ ê±°ìš¸ ë°–ìœ¼ë¡œ í•œ ë°œì§ ë‚´ë”›ê³  ìˆì—ˆë‹¤.",
                "4. ì•„ì´ì˜ ì¹œêµ¬\nìš°ë¦¬ ë‹¤ì„¯ ì‚´ ë”¸ ì†Œí”¼ì•„ëŠ” í•œ ë‹¬ ì „ë¶€í„° 'í‹°ë¯¸'ë¼ëŠ” ìƒìƒ ì† ì¹œêµ¬ì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ê¸° ì‹œì‘í–ˆë‹¤.\nì²˜ìŒì—ëŠ” ê·€ì—¬ìš´ ì•„ì´ì˜ ìƒìƒë ¥ì´ë¼ê³  ìƒê°í–ˆì§€ë§Œ, ì†Œí”¼ì•„ì˜ í–‰ë™ì´ ì ì  ì´ìƒí•´ì§€ê¸° ì‹œì‘í–ˆë‹¤.\nì–´ëŠ ë‚  ì•„ì¹¨, ì†Œí”¼ì•„ê°€ ì•„ì¹¨ ì‹ì‚¬ í…Œì´ë¸”ì—ì„œ ê°‘ìê¸° ë§í–ˆë‹¤.\n\"ì—„ë§ˆ, í‹°ë¯¸ê°€ ì˜¤ëŠ˜ ë°¤ ë‹¹ì‹ ì„ ë¨¹ê² ëŒ€ìš”. ë‹¹ì‹  ì˜í˜¼ì´ ë§›ìˆì„ ê±°ë˜ìš”.\"\nì¶©ê²©ì„ ë°›ì•˜ì§€ë§Œ, ì¹¨ì°©í•˜ê²Œ ëŒ€ë‹µí–ˆë‹¤.\n\"ê±±ì • ë§ˆ, ê·¸ê±´ ê·¸ëƒ¥ ê¿ˆì´ì—ˆì„ ê±°ì•¼. í‹°ë¯¸ëŠ” ì§„ì§œê°€ ì•„ë‹ˆë€ë‹¤.\"\nì†Œí”¼ì•„ëŠ” ì²œì²œíˆ ê³ ê°œë¥¼ ì €ìœ¼ë©° ì‹œë¦¬ì–¼ì„ ë¨¹ì—ˆë‹¤.\n\"ì•„ë‹ˆì—ìš”, ê¿ˆì´ ì•„ë‹ˆì—ìš”. í‹°ë¯¸ê°€ ë°©ê¸ˆ ì œ ê·€ì— ê·¸ë ‡ê²Œ ë§í–ˆì–´ìš”. í‹°ë¯¸ëŠ” ì§€ê¸ˆ ì—„ë§ˆ ë’¤ì— ì„œ ìˆì–´ìš”.\"\nì°¨ê°€ìš´ ê¸°ìš´ì´ ë“±ê³¨ì„ íƒ€ê³  ë‚´ë ¤ê°”ë‹¤.\në’¤ë¥¼ ëŒì•„ë³´ë ¤ëŠ” ìˆœê°„, ì†Œí”¼ì•„ê°€ ë§ë¶™ì˜€ë‹¤.\n\"í‹°ë¯¸ê°€ ë§í•´ìš”. ë’¤ëŒì•„ë³´ë©´ ë” ë¹¨ë¦¬ ì£½ëŠ”ëŒ€ìš”.\"",
                "5. ë³´ì´ì§€ ì•ŠëŠ” ì†ë‹˜\ní•œ ë‹¬ ì „ë¶€í„° ì´ìƒí•œ ì¼ì´ ì¼ì–´ë‚˜ê¸° ì‹œì‘í–ˆë‹¤.\në§¤ì¼ ì•„ì¹¨, ë¶€ì—Œì— ë“¤ì–´ì„œë©´ ì „ë‚  ë°¤ ë‚´ê°€ ì”»ì§€ ì•Šì€ ì ‘ì‹œë“¤ì´ ê¹¨ë—í•˜ê²Œ ì”»ê²¨ì ¸ ìˆì—ˆë‹¤.\nì²˜ìŒì—ëŠ” ëª½ìœ ë³‘ì´ë¼ê³  ìƒê°í–ˆì§€ë§Œ, ëƒ‰ì¥ê³ ì˜ ìŒì‹ë„ ì¡°ê¸ˆì”© ì¤„ì–´ë“¤ê³  ìˆì—ˆë‹¤.\nê°ì‹œ ì¹´ë©”ë¼ë¥¼ ì„¤ì¹˜í–ˆì§€ë§Œ, ì˜ìƒì—ëŠ” ì•„ë¬´ê²ƒë„ ì¡íˆì§€ ì•Šì•˜ë‹¤.\në‹¨ì§€ í•œë°¤ì¤‘ì— ì ‘ì‹œê°€ ìŠ¤ìŠ¤ë¡œ ì›€ì§ì´ë©° ì”»ê²¨ì§€ëŠ” ëª¨ìŠµë§Œ ë³´ì˜€ë‹¤.\nìš©ê¸°ë¥¼ ë‚´ì–´ ì‹íƒ ìœ„ì— ìª½ì§€ë¥¼ ë‚¨ê²¼ë‹¤. \"ë‹¹ì‹ ì€ ëˆ„êµ¬ì‹­ë‹ˆê¹Œ?\"\në‹¤ìŒ ë‚  ì•„ì¹¨, ë‚´ ê¸€ì”¨ì²´ì™€ ë†€ëë„ë¡ ë¹„ìŠ·í•œ í•„ì²´ë¡œ ë‹µì¥ì´ ì™€ ìˆì—ˆë‹¤.\n\"ë‚˜ëŠ” ë‹¹ì‹ ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì‹œê°„ì„ ì—ì„œ ì˜¨.\"\nê·¸ë‚  ì €ë…, ë˜ ë‹¤ë¥¸ ìª½ì§€ë¥¼ ë‚¨ê²¼ë‹¤. \"ì¦ëª…í•´ ë³´ì„¸ìš”.\"\në‹¤ìŒ ë‚  ì•„ì¹¨ ìª½ì§€ì—ëŠ” ë‚´ ì–´ë¦° ì‹œì ˆ ë¹„ë°€ ì¼ê¸°ì¥ì— ì ì—ˆë˜ ë‚´ìš©ì´ ì í˜€ ìˆì—ˆë‹¤. ì•„ë¬´ì—ê²Œë„ ë§í•œ ì  ì—†ëŠ” ë¹„ë°€ì´ì—ˆë‹¤.\nì˜¤ëŠ˜ ì•„ì¹¨, ë§ˆì§€ë§‰ ìª½ì§€ë¥¼ ë°œê²¬í–ˆë‹¤.\n\"ê³§ ì¸ì‚¬ë“œë¦´ê²Œìš”. ì˜¤ëŠ˜ ë°¤, ë‹¹ì‹ ì´ ì ë“  í›„ì—.\"",
                "6. ë§ˆì§€ë§‰ ìŠ¹ê°\ní­ìš°ê°€ ìŸì•„ì§€ëŠ” í•œë°¤ì¤‘, ë‚˜ëŠ” ë§ˆì§€ë§‰ ë²„ìŠ¤ì— ì˜¬ë¼íƒ”ë‹¤.\në¹„ì— í ë»‘ ì –ì€ ì±„ë¡œ ìë¦¬ì— ì•‰ì, ë²„ìŠ¤ëŠ” ê³§ ì¶œë°œí–ˆë‹¤.\nì°½ë°–ìœ¼ë¡œëŠ” ë„ì‹œì˜ ë¶ˆë¹›ë§Œì´ íë¦¿í•˜ê²Œ ë³´ì˜€ë‹¤.\n30ë¶„ì´ ì§€ë‚˜ì ìŠ¹ê°ë“¤ì´ í•˜ë‚˜ë‘˜ ë‚´ë¦¬ê¸° ì‹œì‘í–ˆê³ , ê²°êµ­ ë‚˜ë§Œ ë‚¨ê²Œ ë˜ì—ˆë‹¤.\në²„ìŠ¤ëŠ” ì ì  ë‚¯ì„  ê¸¸ë¡œ ì ‘ì–´ë“¤ì—ˆê³ , ì°½ë°–ìœ¼ë¡œ ë³´ì´ëŠ” í’ê²½ì€ ë” ì´ìƒ ë‚´ê°€ ì•„ëŠ” ë„ì‹œì˜ ëª¨ìŠµì´ ì•„ë‹ˆì—ˆë‹¤.\në¶ˆì•ˆí•´ì§„ ë‚˜ëŠ” ë‹¤ìŒ ì •ë¥˜ì¥ì—ì„œ ë‚´ë¦¬ë ¤ê³  ë²¨ì„ ëˆŒë €ì§€ë§Œ, ë²„ìŠ¤ëŠ” ë©ˆì¶”ì§€ ì•Šì•˜ë‹¤.\nê·¸ì œì„œì•¼ ë‚˜ëŠ” ë°±ë¯¸ëŸ¬ë¥¼ í†µí•´ ìš´ì „ê¸°ì‚¬ì™€ ëˆˆì´ ë§ˆì£¼ì³¤ë‹¤.\në°±ë¯¸ëŸ¬ì— ë¹„ì¹œ ê·¸ì˜ ì–¼êµ´ì€ ê¸°ê´´í•˜ê²Œ ë¯¸ì†Œë¥¼ ì§“ê³  ìˆì—ˆê³ , ê·¸ ëˆˆì€ ì •ìƒì ì¸ ì‚¬ëŒì˜ ê²ƒì´ ì•„ë‹ˆì—ˆë‹¤.\n\"ë“œë””ì–´ ë‹¨ë‘˜ì´ ëë„¤ìš”. ê¸°ë‹¤ë ¸ìŠµë‹ˆë‹¤.\"\nê·¸ê°€ ìš´ì „ëŒ€ì—ì„œ ì†ì„ ë–¼ì, ë²„ìŠ¤ëŠ” ë„ë¡œë¥¼ ë²—ì–´ë‚˜ ê¹Šì€ ìˆ²ìœ¼ë¡œ í–¥í–ˆë‹¤.\në°±ë¯¸ëŸ¬ì˜ ê·¸ëŠ” ì´ì œ ì™„ì „íˆ ëŒì•„ì„œ ë‚˜ë¥¼ ë°”ë¼ë³´ê³  ìˆì—ˆì§€ë§Œ, ìš´ì „ì„ì—ëŠ” ì•„ë¬´ë„ ì—†ì—ˆë‹¤.",
                "7. ë²½ ì†ì˜ ì†Œë¦¬\nìƒˆ ì§‘ìœ¼ë¡œ ì´ì‚¬ì˜¨ ì²«ë‚ ë¶€í„°, ì¹¨ì‹¤ ë²½ ì•ˆì—ì„œ ë¯¸ì„¸í•œ ê¸ëŠ” ì†Œë¦¬ê°€ ë“¤ë ¸ë‹¤.\në¶€ë™ì‚° ì¤‘ê°œì¸ì€ ì˜¤ë˜ëœ ì§‘ì´ë¼ íŒŒì´í”„ ì†Œë¦¬ì¼ ê²ƒì´ë¼ê³  í–ˆì§€ë§Œ, ê·¸ ì†Œë¦¬ëŠ” ë°¤ì´ ê¹Šì–´ì§ˆìˆ˜ë¡ ë” ì»¤ì¡Œë‹¤.\nì‚¼ì¼ì§¸ ë°¤, ë‚˜ëŠ” ì†Œë¦¬ì˜ ê·¼ì›ì§€ì¸ ë²½ì— ê·€ë¥¼ ëŒ€ê³  ë“¤ì—ˆë‹¤.\në†€ëê²Œë„ ê·¸ ì•ˆì—ì„œ ëˆ„êµ°ê°€ ìˆ¨ì„ ì‰¬ëŠ” ì†Œë¦¬ê°€ ë“¤ë ¸ê³ , ë‚´ê°€ ì›€ì§ì¼ ë•Œë§ˆë‹¤ ê·¸ ìˆ¨ì†Œë¦¬ë„ ë”°ë¼ ë©ˆì·„ë‹¤.\në‹¤ì„¯ì§¸ ë‚ , ë²½ì§€ê°€ ë¯¸ì„¸í•˜ê²Œ ì›€ì§ì´ê¸° ì‹œì‘í–ˆê³ , ì‘ì€ í‹ˆì´ ìƒê²¼ë‹¤.\nê·¸ í‹ˆì—ì„œ ì¢…ì´ ì¡°ê°ì´ ìŠ¬ë©°ì‹œ ë‚˜ì™”ë‹¤. \"ë„ì™€ì£¼ì„¸ìš”. ì—¬ê¸° ê°‡í˜€ ìˆì–´ìš”.\"\nìš©ê¸°ë¥¼ ë‚´ì–´ ë²½ì§€ë¥¼ ì¡°ê¸ˆ ë” ì°¢ì–´ë³´ë‹ˆ, ê·¸ ë’¤ì—ëŠ” ë˜ ë‹¤ë¥¸ ë²½ì§€ê°€ ìˆì—ˆê³ , ê±°ê¸°ì—ëŠ” ì˜¤ë˜ëœ ì‚¬ì§„ì´ ë¶™ì–´ ìˆì—ˆë‹¤.\nê·¸ ì‚¬ì§„ ì†ì—ëŠ” ë‚´ê°€ ì§€ê¸ˆ ì‚´ê³  ìˆëŠ” ì´ ë°©ì—ì„œ ì°ì€ ë‚´ ëª¨ìŠµì´ ìˆì—ˆë‹¤.\nê·¸ë¦¬ê³  ì‚¬ì§„ ì† ë‚´ ëª¨ìŠµì€ ì§€ê¸ˆ ë‚´ê°€ ì…ê³  ìˆëŠ” ì˜·ì„ ê·¸ëŒ€ë¡œ ì…ê³  ìˆì—ˆë‹¤.",
                "8. ë§ˆì§€ë§‰ ì‚¬ì§„\ní• ë¨¸ë‹ˆê°€ ëŒì•„ê°€ì‹  í›„, ê°€ì¡±ë“¤ì€ ê·¸ë…€ì˜ ì˜¤ë˜ëœ ì§‘ì„ ì •ë¦¬í•˜ê¸° ì‹œì‘í–ˆë‹¤.\nì§€í•˜ì‹¤ì—ì„œ ë‚¡ì€ ì‚¬ì§„ì²©ì„ ë°œê²¬í–ˆê³ , ê·¸ ì•ˆì—ëŠ” í• ë¨¸ë‹ˆì˜ ì–´ë¦° ì‹œì ˆë¶€í„° ìµœê·¼ê¹Œì§€ì˜ ì‚¬ì§„ë“¤ì´ ê°€ë“í–ˆë‹¤.\nì‚¬ì§„ì²©ì„ ë„˜ê¸°ë©° í• ë¨¸ë‹ˆì˜ ì¸ìƒì„ ë˜ëŒì•„ë³´ëŠ” ë™ì•ˆ, ë§ˆìŒì´ ë”°ëœ»í•´ì¡Œë‹¤.\ní•˜ì§€ë§Œ ë§ˆì§€ë§‰ í˜ì´ì§€ì— ë„ë‹¬í–ˆì„ ë•Œ, ë‚˜ëŠ” ê²½ì•…í•  ìˆ˜ë°–ì— ì—†ì—ˆë‹¤.\nê·¸ í˜ì´ì§€ì—ëŠ” ì–´ì œ ìˆì—ˆë˜ í• ë¨¸ë‹ˆì˜ ì¥ë¡€ì‹ ì‚¬ì§„ì´ ë¶™ì–´ ìˆì—ˆë‹¤.\nê²€ì€ ì˜·ì„ ì…ì€ ê°€ì¡±ë“¤, ê´€ ì£¼ìœ„ì— ë†“ì¸ ê½ƒ, ì‹¬ì§€ì–´ ë‚´ê°€ ì½ì—ˆë˜ ì¶”ëª¨ì‚¬ë¥¼ ì½ëŠ” ì¥ë©´ê¹Œì§€.\në–¨ë¦¬ëŠ” ì†ìœ¼ë¡œ ì‚¬ì§„ì²©ì„ ë®ìœ¼ë ¤ëŠ” ìˆœê°„, ë§ˆì§€ë§‰ ì‚¬ì§„ ë’¤ì— í• ë¨¸ë‹ˆì˜ í•„ì²´ë¡œ ì“°ì¸ ë©”ëª¨ë¥¼ ë°œê²¬í–ˆë‹¤.\n\"ë‚´ ì†Œì¤‘í•œ ì†ì£¼ì•¼, ë‹¤ìŒ ì¥ì— ë„¤ ì‚¬ì§„ì´ ê³§ ë”í•´ì§ˆ ê±°ë€ë‹¤.\"\nê·¸ë¦¬ê³  ê·¸ ë‹¤ìŒ í˜ì´ì§€ë¥¼ ë„˜ê¸°ì, ê±°ê¸°ì—ëŠ” ì•„ì§ ì±„ì›Œì§€ì§€ ì•Šì€ ë¹ˆ ê³µê°„ì´ ìˆì—ˆê³ , ë‚ ì§œë§Œ ì í˜€ ìˆì—ˆë‹¤ - ë‚´ì¼ì˜ ë‚ ì§œì˜€ë‹¤.",
                "9. ì ë“¤ì§€ ë§ˆì„¸ìš”\nêµí†µì‚¬ê³  í›„ ë³‘ì›ì—ì„œ ê¹¨ì–´ë‚¬ì„ ë•Œ, ë‚˜ëŠ” ì‹¬í•œ í˜¼ë€ ìƒíƒœì˜€ë‹¤.\nì˜ì‚¬ë“¤ì€ ë‚´ ìƒíƒœê°€ ì•ˆì •ì ì´ë¼ê³  í–ˆì§€ë§Œ, ì™ ì§€ ê·¸ë“¤ì˜ ëˆˆë¹›ì´ ë¶ˆì•ˆí•´ ë³´ì˜€ë‹¤.\në°¤ ê·¼ë¬´ ì‹œê°„ì´ ë˜ì, ì Šì€ ê°„í˜¸ì‚¬ê°€ ë‚´ ë³‘ì‹¤ì— ë“¤ì–´ì™”ë‹¤.\nê·¸ë…€ëŠ” ë‚´ í™œë ¥ ì§•í›„ë¥¼ í™•ì¸í•˜ë©° í‰ì†Œì™€ ë‹¤ë¦„ì—†ì´ í–‰ë™í–ˆì§€ë§Œ, ê°‘ìê¸° ë‹¤ë¥¸ ì˜ë£Œì§„ë“¤ì´ ì—†ëŠ” ê²ƒì„ í™•ì¸í•œ í›„ ë‚´ê²Œ ê°€ê¹Œì´ ë‹¤ê°€ì™”ë‹¤.\n\"ë“¤ì–´ì£¼ì„¸ìš”,\" ê·¸ë…€ê°€ ë–¨ë¦¬ëŠ” ëª©ì†Œë¦¬ë¡œ ì†ì‚­ì˜€ë‹¤. \"ì ˆëŒ€ ì ë“¤ì§€ ë§ˆì„¸ìš”. ë¬´ìŠ¨ ì¼ì´ ìˆì–´ë„ ê¹¨ì–´ ìˆì–´ì•¼ í•´ìš”.\"\nì´ìœ ë¥¼ ë¬¼ìœ¼ë ¤ í–ˆì§€ë§Œ, ê·¸ë…€ëŠ” ê³ ê°œë¥¼ ì €ì—ˆë‹¤.\n\"ì˜ì‚¬ê°€ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”. ê·¸ë“¤ì€... ë‹¹ì‹ ì´ ìƒê°í•˜ëŠ” ê·¸ëŸ° ì˜ì‚¬ê°€ ì•„ë‹ˆì—ìš”.\"\nê·¸ë…€ì˜ ëˆˆì—ì„œ ëˆˆë¬¼ì´ í˜ë €ê³ , ë§ˆì§€ë§‰ìœ¼ë¡œ ë§ë¶™ì˜€ë‹¤.\n\"ê·¸ë“¤ì€ ë§¤ì¼ ë°¤ í•œ ëª…ì”© ë°ë ¤ê°€ìš”. ì˜¤ëŠ˜ ë°¤ì€ ë‹¹ì‹  ì°¨ë¡€ì˜ˆìš”.\"",
                "10. ë¹ˆ ì§‘\n2ì£¼ê°„ì˜ í•´ì™¸ ì¶œì¥ì„ ë§ˆì¹˜ê³  ì§‘ìœ¼ë¡œ ëŒì•„ì™”ë‹¤.\nì—´ì‡ ë¡œ í˜„ê´€ë¬¸ì„ ì—´ìë§ˆì, ìµìˆ™í•œ ì§‘ ì•ˆì˜ í–¥ê¸°ì™€ í•¨ê»˜ ëˆ„êµ°ê°€ ë‚˜ë¥¼ ë°˜ê²¨ì£¼ëŠ” ëª©ì†Œë¦¬ê°€ ë“¤ë ¸ë‹¤.\n\"ë“œë””ì–´ ëŒì•„ì™”êµ¬ë‚˜, ë³´ê³  ì‹¶ì—ˆì–´!\"\nìˆœê°„ ì˜¨ëª¸ì— ì†Œë¦„ì´ ë‹ì•˜ë‹¤. ë‚˜ëŠ” í˜¼ì ì‚°ë‹¤.\n5ë…„ ì „ ì´í˜¼ í›„ ì´ ì§‘ì—ëŠ” ë‚˜ ì™¸ì— ì•„ë¬´ë„ ì‚´ì§€ ì•ŠëŠ”ë‹¤.\nì²œì²œíˆ ê±°ì‹¤ë¡œ ê±¸ì–´ê°€ì, í…Œì´ë¸” ìœ„ì—ëŠ” ë”°ëœ»í•œ ì €ë… ì‹ì‚¬ê°€ ì¤€ë¹„ë˜ì–´ ìˆì—ˆê³ , TVëŠ” ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì¼œì ¸ ìˆì—ˆë‹¤.\në¶€ì—Œì—ì„œëŠ” ë¬¼ì´ ë“ëŠ” ì†Œë¦¬ê°€ ë“¤ë ¸ê³ , ëˆ„êµ°ê°€ í—ˆë°í•˜ëŠ” ì†Œë¦¬ê°€ ë“¤ë ¸ë‹¤.\nê·¸ ëª©ì†Œë¦¬ëŠ” ë„ˆë¬´ë‚˜ ìµìˆ™í–ˆë‹¤ - ê·¸ê²ƒì€ ë‚´ ëª©ì†Œë¦¬ì˜€ë‹¤.\në¶€ì—Œìœ¼ë¡œ ë“¤ì–´ì„œì, ê·¸ê³³ì—ëŠ” ë‚´ ëª¨ìŠµ ê·¸ëŒ€ë¡œì¸ ì‚¬ëŒì´ ì„œ ìˆì—ˆë‹¤.\nê·¸ ì‚¬ëŒì€ ë‚  ë³´ë”ë‹ˆ ë¯¸ì†Œì§€ì—ˆë‹¤.\n\"ì´ì œ ë‚´ê°€ ë°”ê¹¥ ì„¸ìƒì„ ê²½í—˜í•  ì°¨ë¡€ì•¼. ê³ ë§ˆì›Œ, ì§‘ ì˜ ë´ì¤˜.\""
            ];

            // ê° ì´ì•¼ê¸°ì— í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ URL ë°°ì—´ (â˜…â˜…â˜… ì—¬ê¸°ì— ì‹¤ì œ ì´ë¯¸ì§€ URLì„ ë„£ì–´ì£¼ì„¸ìš”! â˜…â˜…â˜…)
            const horrorStoryImages = [
                "image_url_1.jpg", // 1. ë§ˆì§€ë§‰ ë©”ì‹œì§€
                "image_url_2.jpg", // 2. ê±°ìš¸ ì† ë‚¯ì„  ì´
                "image_url_3.jpg", // 3. ì§€í•˜ì‹¤ì˜ ì†Œë¦¬
                "image_url_4.jpg", // 4. ì•„ì´ì˜ ì¹œêµ¬
                "image_url_5.jpg", // 5. ë³´ì´ì§€ ì•ŠëŠ” ì†ë‹˜
                "image_url_6.jpg", // 6. ë§ˆì§€ë§‰ ìŠ¹ê°
                "image_url_7.jpg", // 7. ë²½ ì†ì˜ ì†Œë¦¬
                "image_url_8.jpg", // 8. ë§ˆì§€ë§‰ ì‚¬ì§„
                "image_url_9.jpg", // 9. ì ë“¤ì§€ ë§ˆì„¸ìš”
                "image_url_10.jpg" // 10. ë¹ˆ ì§‘
            ];

            // ì´ë¯¸ ë“¤ë ¤ì¤€ ì´ì•¼ê¸°ì˜ ì¸ë±ìŠ¤ë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´
            let toldStoryIndices = [];

            // ì±„íŒ…ì°½ì— ë©”ì‹œì§€ë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
            function addMessage(content, sender, isStoryLine = false) {
                console.log(`Adding message: "${typeof content === 'string' ? content.substring(0, 30) + '...' : 'Image'}" from ${sender}`); // Debug log
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('flex', sender === 'user' ? 'justify-end' : 'justify-start', 'mb-2');

                if (typeof content === 'string') { // í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì²˜ë¦¬
                    const messageBubble = document.createElement('div');
                    messageBubble.classList.add(
                        'p-2', 
                        'rounded-none', 
                        'max-w-md', 
                        'text-lg', 
                        'bg-transparent', 
                        'break-words',
                        'whitespace-pre-wrap' // ì¤„ë°”ê¿ˆ ìœ ì§€
                    );
                    
                    if (sender === 'user') {
                        messageBubble.classList.add('text-green-300'); 
                    } else {
                        messageBubble.classList.add('text-green-500', 'text-glow'); 
                    }

                    // ì§§ì€ ê¸°ë³¸ ì‘ë‹µì—ë§Œ íƒ€ì´í•‘ íš¨ê³¼ ì ìš©
                    if (sender === 'bot' && !isStoryLine) {
                        messageBubble.textContent = ''; 
                        let i = 0;
                        const typingInterval = setInterval(() => {
                            if (i < content.length) {
                                messageBubble.textContent += content.charAt(i);
                                i++;
                                chatbox.scrollTop = chatbox.scrollHeight; 
                            } else {
                                clearInterval(typingInterval);
                                console.log("Bot typing finished."); 
                            }
                        }, 50); 
                    } else {
                        // ì‚¬ìš©ì ë©”ì‹œì§€ ë° ì´ì•¼ê¸° ì¤„ì€ ë°”ë¡œ í‘œì‹œ
                        messageBubble.textContent = content; 
                        // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ìŠ¤í¬ë¡¤ (íƒ€ì´í•‘ íš¨ê³¼ê°€ ì—†ìœ¼ë¯€ë¡œ)
                        setTimeout(() => { chatbox.scrollTop = chatbox.scrollHeight; }, 50);
                    }
                    messageDiv.appendChild(messageBubble);

                } else if (content instanceof HTMLImageElement) { // ì´ë¯¸ì§€ ìš”ì†Œ ì²˜ë¦¬
                    messageDiv.appendChild(content);
                    setTimeout(() => { chatbox.scrollTop = chatbox.scrollHeight; }, 100); // ì´ë¯¸ì§€ ë¡œë”© ì‹œê°„ ê³ ë ¤
                }
                
                chatbox.appendChild(messageDiv);
                // ë©”ì‹œì§€ ì¶”ê°€ í›„ ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ ì´ë™
                // ì•½ê°„ì˜ ì§€ì—°ì„ ì£¼ì–´ ë Œë”ë§ í›„ ìŠ¤í¬ë¡¤ë˜ë„ë¡ í•¨
                setTimeout(() => { chatbox.scrollTop = chatbox.scrollHeight; }, 0);
            }

            // ì´ì•¼ê¸°ë¥¼ í•œ ì¤„ì”© ì¶œë ¥í•˜ê³  ë§ˆì§€ë§‰ì— ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
            async function displayStory(storyText, storyIndex) {
                const lines = storyText.split('\n'); // ì¤„ë°”ê¿ˆ ë¬¸ìë¡œ ë¶„ë¦¬
                for (const line of lines) {
                    if (line.trim() !== '') { // ë¹ˆ ì¤„ì€ ê±´ë„ˆë›°ê¸°
                        addMessage(line, 'bot', true); // isStoryLine í”Œë˜ê·¸ë¥¼ trueë¡œ ì „ë‹¬
                        await new Promise(resolve => setTimeout(resolve, 1500)); // ê° ì¤„ ì‚¬ì´ì— 1.5ì´ˆ ì§€ì—°
                    }
                }

                // ì´ì•¼ê¸° ëë‚œ í›„ ì´ë¯¸ì§€ í‘œì‹œ
                const imageUrl = horrorStoryImages[storyIndex];
                // Placeholder URLì´ ì•„ë‹Œì§€ í™•ì¸í•˜ê³ , URLì´ ìœ íš¨í•œ í˜•ì‹ì¸ì§€ ê°„ë‹¨íˆ ì²´í¬ (http ë˜ëŠ” httpsë¡œ ì‹œì‘)
                if (imageUrl && imageUrl.startsWith('http')) { 
                    console.log(`Displaying image: ${imageUrl}`);
                    const imgElement = document.createElement('img');
                    imgElement.src = imageUrl;
                    imgElement.alt = `ê³µí¬ ì´ì•¼ê¸° ${storyIndex + 1} ì´ë¯¸ì§€`;
                    imgElement.classList.add('chat-image'); // ìŠ¤íƒ€ì¼ ì ìš©
                    // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ì²˜ë¦¬
                    imgElement.onerror = function() {
                        console.error(`Failed to load image: ${imageUrl}`);
                        const errorMsg = document.createElement('p');
                        errorMsg.textContent = '[ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤]';
                        errorMsg.classList.add('text-red-500', 'text-sm', 'italic');
                        // ì´ë¯¸ì§€ ëŒ€ì‹  ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í¬í•¨í•˜ëŠ” divë¥¼ ì¶”ê°€
                        const errorDiv = document.createElement('div');
                        errorDiv.classList.add('flex', 'justify-start', 'mb-2');
                        const errorBubble = document.createElement('div');
                        errorBubble.classList.add('p-2', 'rounded-none', 'max-w-md', 'text-lg', 'bg-transparent');
                        errorBubble.appendChild(errorMsg);
                        errorDiv.appendChild(errorBubble);
                        chatbox.appendChild(errorDiv);
                        chatbox.scrollTop = chatbox.scrollHeight;
                    };
                     // ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ë©´ ë©”ì‹œì§€ë¡œ ì¶”ê°€
                    imgElement.onload = function() {
                         addMessage(imgElement, 'bot', true); // ì´ë¯¸ì§€ ìš”ì†Œë¥¼ ë©”ì‹œì§€ë¡œ ì¶”ê°€
                    }
                } else {
                    console.log(`No valid image URL for story index ${storyIndex}. Provided: ${imageUrl}`);
                }

                 // ì´ë¯¸ì§€ í‘œì‹œ (ë˜ëŠ” ë¯¸í‘œì‹œ) í›„ ì•½ê°„ì˜ ì§€ì—° ì¶”ê°€ í›„ ì…ë ¥ í™œì„±í™”
                 await new Promise(resolve => setTimeout(resolve, 500)); 

                // ì…ë ¥ í™œì„±í™”
                userInput.disabled = false;
                sendButton.disabled = false;
                sendButton.classList.remove('opacity-50', 'cursor-not-allowed');
                console.log("Story display finished. Input re-enabled.");
                userInput.focus();
            }

            // ë©”ì‹œì§€ ì „ì†¡ ì²˜ë¦¬ í•¨ìˆ˜
            async function sendMessage() {
                console.log("sendMessage function called");
                const message = userInput.value.trim();
                console.log(`User input: "${message}"`); // ë¡œê·¸ ìˆ˜ì •

                if (message === '') {
                    console.log("Empty message, not sending.");
                    return;
                }

                // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì‹œì‘ ì‹œë„ (ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í•„ìš”)
                try {
                    if (Tone.context.state !== 'running') {
                        await Tone.start();
                        console.log("AudioContext started by user interaction (send).");
                    }
                } catch (error) {
                    console.error("Failed to start AudioContext on send:", error);
                    // ì˜¤ë””ì˜¤ ì‹œì‘ ì‹¤íŒ¨í•´ë„ ì±„íŒ…ì€ ê³„ì† ì§„í–‰
                }

                addMessage("> " + message, 'user');
                userInput.value = '';

                userInput.disabled = true;
                sendButton.disabled = true;
                sendButton.classList.add('opacity-50', 'cursor-not-allowed');
                console.log("Input disabled, waiting for bot response...");

                // "ì´ì•¼ê¸° í•´ì¤˜" ì™€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸ (ë„ì–´ì“°ê¸° í¬í•¨)
                if (message === "ì´ì•¼ê¸° í•´ì¤˜") { 
                    console.log("Story requested.");

                    if (toldStoryIndices.length >= horrorStories.length) {
                        console.log("All stories told, resetting.");
                        toldStoryIndices = []; 
                        // ëª¨ë“  ì´ì•¼ê¸°ë¥¼ ë‹¤ í–ˆë‹¤ëŠ” ë©”ì‹œì§€ ì¶”ê°€
                        addMessage("...ëª¨ë“  ì´ì•¼ê¸°ë¥¼ ë‹¤ í•œ ê²ƒ ê°™êµ°ìš”. ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤...", 'bot', false); 
                        // ì ì‹œ í›„ ì…ë ¥ í™œì„±í™” (ì´ì•¼ê¸° í‘œì‹œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œ ì§ì ‘ í™œì„±í™”)
                        setTimeout(() => {
                            userInput.disabled = false;
                            sendButton.disabled = false;
                            sendButton.classList.remove('opacity-50', 'cursor-not-allowed');
                            console.log("Input re-enabled after reset message.");
                            userInput.focus();
                        }, 1000); // ë©”ì‹œì§€ í‘œì‹œ ì‹œê°„ ê³ ë ¤
                        return; 
                    }

                    let randomIndex;
                    do {
                        randomIndex = Math.floor(Math.random() * horrorStories.length);
                    } while (toldStoryIndices.includes(randomIndex));

                    toldStoryIndices.push(randomIndex); 
                    const selectedStory = horrorStories[randomIndex];
                    console.log(`Selected story index: ${randomIndex}, Told indices: ${toldStoryIndices}`);
                    
                    // ì´ì•¼ê¸° í‘œì‹œ í•¨ìˆ˜ í˜¸ì¶œ (ë¹„ë™ê¸°)
                    // ì…ë ¥ í™œì„±í™”ëŠ” displayStory í•¨ìˆ˜ ë‚´ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
                    displayStory(selectedStory, randomIndex); 

                } else {
                    // "ì´ì•¼ê¸° í•´ì¤˜"ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì…ë ¥ ì²˜ë¦¬
                    console.log("Default response triggered."); // ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€
                    setTimeout(() => {
                        console.log("Bot timeout finished, preparing default response.");
                        const randomIndex = Math.floor(Math.random() * defaultBotResponses.length);
                        const randomResponse = defaultBotResponses[randomIndex];
                        console.log(`Selected response: "${randomResponse}"`);
                        addMessage(randomResponse, 'bot', false); // isStoryLine í”Œë˜ê·¸ false
                        
                        // ì§§ì€ ì‘ë‹µ í›„ ë°”ë¡œ ì…ë ¥ í™œì„±í™”
                        userInput.disabled = false;
                        sendButton.disabled = false;
                        sendButton.classList.remove('opacity-50', 'cursor-not-allowed');
                        console.log("Input re-enabled after default response.");
                        userInput.focus();
                    }, 1000 + Math.random() * 500); 
                }
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            sendButton.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter' && !userInput.disabled) {
                    sendMessage();
                }
            });

             userInput.focus();
             console.log("ê³µí¬ ì±—ë´‡ ì´ˆê¸°í™” ì™„ë£Œ.");
        });
    </script>
</body>
</html>
